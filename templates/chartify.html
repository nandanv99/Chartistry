<!doctype html>
<html lang="en">
  <head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chartify</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="icon" type="image/png" href="https://h5p.org/sites/default/files/styles/medium-logo/public/logos/chart-icon-color.png?itok=kpLTYHHJ">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <style>
    body {
  margin: 0;
  overflow: hidden;
  <!-- background: #152B39; -->
  font-family: Courier, monospace;
  font-size: 14px;
  color:#ccc; 
}

.wrapper {
  display: block;
  margin: 5em auto;
  border: 1px solid #555;
  width: 700px;
  height: 350px;
  position: relative;
}
p{text-align:center;}
.label {
  height: 1em;
  padding: .3em;
  background: rgba(255, 255, 255, .8);
  position: absolute;
  display: none;
  color:#333;
  
}
.crd{
  border-radius: 15px;
  transition: transform 0.2s ease-in-out;
}
.card:hover {
  background-color: grey !important;
}
.no-hover:hover:not(.keep-hover) {
    background-color: white;
  }

  </style>
  
  <body id="body bg-dark">
    <div class="container-fluid bg-dark">
      <div class="row p-3">
        <div class="col-xl-3 col-12 border border-light border-right  "style="box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);border-radius: 10px;height: 95vh; overflow-y: scroll;border-radius:10px;" >

          <div class="row ">
            <h5 class="text-center p-3 text-center" style="font-family:'Times New Roman', Times, serif;">Attributes</h5>
            {% comment %} <small class="text-white text-center p-0">Cool.csv</small>  {% endcomment %}
            <a id="add-table" class="text-white" >Show data table </a>
            <hr>
              <div id="modules">
                {% for item in params.head %}
                <div class="col-12 p-1 mb-1 dropright" style="width:100%;">
                  <div class="  card crd drag bg-transparent  border-0" type="button" data-toggle="dropdown" aria-expanded="false" style="border-radius:0px;width:100%;">
                    <a class=" btn drag text-dark my-2 text-white border-0"><i>{{item}}</i></a>
                    <div class="dropdown-menu">
                      <a class="dropdown-item add-chart" onclick="showAlert()" href="#">{{item}} </a>
                      {% comment %} <a class="dropdown-item update-x-axis" href="#" onclick="setXAxisLabels(['nandan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul','aug']); return false;" >Set as X-axis</a> {% endcomment %}
                      <a class="dropdown-item update-x-axis" href="#" onclick="setXAxisLabels({{item}}); return false;" >Set as X-axis</a>
                      <a class="dropdown-item" href="#">Choose another visual</a>
                    </div>
                  </div>
                </div>
                {% endfor %}
                {% for item in params.recursive %}
                  <div class="col-12 p-1 mb-1 dropright" style="width:100%;">
                  <div class="  card crd drag bg-transparent  border-0" type="button" data-toggle="dropdown" aria-expanded="false" style="border-radius:0px;width:100%;">
                    <a class=" btn drag text-dark my-2 text-white border-0"><i>{{item}}</i></a>
                    <div class="dropdown-menu">
                      <a class="dropdown-item add-pie-chart" onclick="showAlert()" href="#">{{item}} </a>
                      {% comment %} <a class="dropdown-item update-x-axis" href="#" onclick="setXAxisLabels(['nandan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul','aug']); return false;" >Set as X-axis</a> {% endcomment %}
                      <a class="dropdown-item update-x-axis" href="#" onclick="setXAxisLabels({{item}}); return false;" >Set as X-axis</a>
                      <a class="dropdown-item" href="#">Choose another visual</a>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
          </div>
        </div>

        <div class="col-xl-9 col-12 " >
          <div class="row  " style="box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);border-radius: 10px;">
            <div class="col-12 border border-light" style="border-radius:10px;" >

            <div class=" border border-danger alert alert-dark  alert-dismissible fade show position-fixed top-0 end-0" role="alert" id="myAlert" style="z-index: 9999;border-radius:10px; margin:10px;display:none;">
              Your message was successfully sent!
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
            </div>
              <div class="col-12" class="border border-light" style="overflow-y: scroll; ">
                <form action="#">
                
                  <div id="dropzone" class="  text-center" style="height:95vh;border-radius:10px"><small>Here you can drop the attributes</small></div>
                </form>
                
              </div>

            </div>
          </div>
          
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function() {
        // initial state is content
        var isTableVisible = false;
        
        $("#add-table").click(function(event) {
          event.preventDefault();
          
          // check if table is visible
          if (isTableVisible) {
            // if it is, remove the table and show the original content
            $("#dropzone table").remove();
            $("#dropzone").text("Some content here");
            isTableVisible = false;
          } else {
            // if it isn't, create the table and hide the original content
            var table = $("<table>").addClass("table table-striped table-bordered table-hover");
            var headers = $("<thead><tr><th class='text-white'>ID</th><th class='text-white'>Name</th><th class='text-white'>Email</th></tr></thead>");
            var rows = $("<tbody><tr><td class='text-white'>1</td><td class='text-white'>John Doe</td><td class='text-white'>johndoe@example.com</td></tr><tr><td>2</td><td>Jane Doe</td><td>janedoe@example.com</td></tr></tbody>");
            table.append(headers).append(rows);
      
            $("#dropzone").html(table);
            isTableVisible = true;
          }
        });
      });
      
      
    </script>
    

    <script>
      function showAlert() {
        var alertElement = document.getElementById("myAlert");
        alertElement.style.display = "block";
        setTimeout(function() {
          alertElement.style.display = "none";
        }, 5000);
      }
    </script>



    <script>
      {% comment %} {% for key, value in params.items %}
         var {{ key }} = [{{ value|join:', ' }}];
        console.log("{{key}} :",{{key}}); 
        
      {% endfor %} {% endcomment %}
      {% for key, value in params.items %}
    {% if value|is_list %}
        var {{ key }} = [ {% for item in value %}"{{ item }}"{% if not forloop.last %}, {% endif %}{% endfor %} ];
    {% else %}
        var {{ key }} = "{{ value }}";
    {% endif %}
    console.log("{{key}} :",{{key}}); 
{% endfor %}


    </script>

    <script>
      $(document).ready(function() {
        console.log("Cool")
        setXAxisLabels(['Nands', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul']);
      });

      function setXAxisLabels(labels) {
        console.log("Cool1")
        $('.drop-item ').each(function() {
          console.log("Cool2")
          var chart = $(this).data('chart');
          if (chart) {
            chart.data.labels = labels;
            chart.update();
          }
        });
      }

    </script>

    {% comment %} <script>
      $('.drag').draggable({
        appendTo: 'body',
        helper: 'clone'
      });

      $('#dropzone').droppable({
        activeClass: 'active',
        hoverClass: 'hover',
        accept: ":not(.ui-sortable-helper)", 
        drop: function (e, ui) {
          var attribute_name = ui.draggable.text();
          var $existingChart = $('.drop-item canvas[data-attribute="' + attribute_name + '"]');
          if ($existingChart.length) {
            // Chart already exists, remove the canvas and create a new chart
            var chart = $existingChart.data('chart');
            chart.destroy();
            $existingChart.parent().remove();
          }
        
          // Create the chart with a single dataset
          var $el = $('<div class="drop-item"></div>');
          $el.append($('<canvas></canvas>').attr('data-attribute', attribute_name));
          $el.append($('<button type="button" class="btn btn-default btn-xs remove"><span class="fa-solid fa-trash text-white"></span></button>').click(function () { 
            var $parent = $(this).parent();
            var chart = $parent.find('canvas').data('chart');
            chart.destroy();
            $parent.remove(); 
          }));
          $(this).append($el);

          // Generate random data for the chart
          var data = [];
          for (var i = 0; i < 7; i++) {
            data.push(Math.floor(Math.random() * 100));
          }

          // Create the chart with a single dataset
          var ctx = $el.find('canvas')[0].getContext('2d');
          var chart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
              datasets: [{
                label: attribute_name,
                data: window[attribute_name],
                borderWidth: 1,
                borderColor: '#d92136',
                yAxisID: attribute_name // Use attribute name as ID for y-axis scale
              }]
            },
            options: {
              scales: {
                yAxes: [{
                  id: attribute_name,
                  position: 'right',
                  ticks: {
                    beginAtZero: true
                  }
                }]
              }
            }
          });
          $el.find('canvas').data('chart', chart);
          // Show success message
          var $successToast = $('<div class="toast" role="alert" aria-live="assertive" aria-atomic="true">\
            <div class="toast-header">\
              <strong class="mr-auto">Success</strong>\
              <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">\
                <span aria-hidden="true">&times;</span>\
              </button>\
            </div>\
            <div class="toast-body">Chart added successfully!</div>\
          </div>');

          $('body').append($successToast);
          $successToast.toast({
            autohide: true,
            delay: 2000,
            animation: true,
            position: 'top-right'
          });

          $successToast.toast('show');
        }
        }).sortable({
          items: '.drop-item',
          sort: function () {
            $(this).removeClass("active");
          }
        });

    </script> {% endcomment %}
    
    <script>
      $('.add-chart').click('click',function() {
        var attribute_name = $(this).text().trim() // Replace with desired attribute name
        var $existingChart = $('.drop-item canvas[data-attribute="' + attribute_name + '"]');
        if ($existingChart.length) {
          // Chart already exists, update its data
          var chart = $existingChart.data('chart');
          var newData = [];
          for (var i = 0; i < 7; i++) {
            newData.push(Math.floor(Math.random() * 100));
          }
          var existingDataset = chart.data.datasets.find(function(dataset) {
            return dataset.label === attribute_name;
          });
          if (existingDataset) {
            // Dataset already exists, update its data
            existingDataset.data = newData;
          } else {
            // Add new dataset with its own y-axis scale
            var maxScale = Math.max.apply(Math, chart.data.datasets.map(function(dataset) {
              return Math.max.apply(Math, dataset.data);
            }));
            var newScale = maxScale + 20; // Add 20 to max value for new scale
            chart.options.scales.yAxes.push({
              id: attribute_name,
              position: 'right',
              ticks: {
                beginAtZero: true,
                suggestedMax: newScale
              }
            });
            chart.data.datasets.push({
              label: attribute_name,
              data: newData,
              borderWidth: 1,
              yAxisID: attribute_name // Use attribute name as ID for new y-axis scale
            });
          }
          chart.update();
        } else {
          // Chart doesn't exist, create a new one with a single dataset
          var $el = $('<canvas class="drop-item"></canvas>').attr('data-attribute', attribute_name);
          console.log(window[attribute_name])
          $el.append($('<button type="button" class="btn btn-default btn-xs remove"><span class="fa-solid fa-trash text-white "></span></button>').click(function () { $(this).parent().detach(); }));
          $('#dropzone').append($el);

          // Generate random data for the chart


          // Create the chart with a single dataset
          var ctx = $el[0].getContext('2d');
          var chart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
              datasets: [{
                label: attribute_name,
                data: window[attribute_name],
                borderWidth: 1,
                borderColor: '#d92136',
                yAxisID: attribute_name // Use attribute name as ID for y-axis scale
              }]
            },
            options: {
              scales: {
                yAxes: [{
                  id: attribute_name,
                  position: 'right',
                  ticks: {
                    beginAtZero: false
                  },
                }]
              }
            }
          });
          $el.data('chart', chart);
        }
      });
    </script>
    <script>
    $('.add-pie-chart').click('click', function() {
  var attribute_name = $(this).text().trim(); // Replace with desired attribute name
  var $existingChart = $('.drop-item canvas[data-attribute="' + attribute_name + '"]');
  if ($existingChart.length) {
    // Chart already exists, update its data
    var chart = $existingChart.data('chart');
    var newData = [];
    for (var i = 0; i < 4; i++) {
      newData.push(Math.floor(Math.random() * 100));
    }
    chart.data.datasets[0].data = newData;
    chart.update();
  } else {
    // Chart doesn't exist, create a new one
    var $el = $('<canvas class="drop-item"></canvas>').attr('data-attribute', attribute_name);
    $el.append($('<button type="button" class="btn btn-default btn-xs remove"><span class="fa-solid fa-trash text-white"></span></button>').click(function () { $(this).parent().detach(); }));
    $('#dropzone').append($el);

    // Generate random data for the chart
    var data = [];
    for (var i = 0; i < 4; i++) {
      data.push(Math.floor(Math.random() * 100));
    }
    console.log("data is pie :",data)

    // Create the pie chart
    var ctx = $el[0].getContext('2d');
    {% comment %} var count = countUnique(window[attribute_name]) {% endcomment %}
    {% comment %} console.log("count of unique is :",count) {% endcomment %}
    var chart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Label 1', 'Label 2', 'Label 3', 'Label 4'],
        datasets: [{
          label: attribute_name,
          data: data,
          backgroundColor: [
            '#ff6384',
            '#36a2eb',
            '#ffce56',
            '#d92136'
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        legend: {
          position: 'bottom'
        },
        title: {
          display: true,
          text: attribute_name
        },
        animation: {
          animateScale: true,
          animateRotate: true
        }
      }
    });
    $el.data('chart', chart);
  }
});
function countArray(arr) {
  var count = {};
  for (var i = 0; i < arr.length; i++) {
    var key = arr[i];
    if (!count[key]) {
      count[key] = 1;
    } else {
      count[key]++;
    }
  }
  var result = [];
  for (var prop in count) {
    result.push({name: prop, count: count[prop]});
  }
  return result;
}



    </script>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
  </body>
</html>